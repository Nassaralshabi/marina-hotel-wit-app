# ุชุญุฏูุซ ุฃูุงู ูุธุงู ุงููุงุชุณุงุจ - ููุฏู ูุงุฑููุง

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุญุฏูุซ ูุธุงู ุงููุงุชุณุงุจ ูู ููุฏู ูุงุฑููุง ููุถูู ุฅุฑุณุงู ุงูุฑุณุงุฆู **ููุท ูููุฒูุงุก ุงููุณุฌููู** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงูุชุญูู ุงูุดุงูู ูู ุตุญุฉ ุงูุจูุงูุงุช.

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุงูุชุญูู ูู ุตุญุฉ ุงููุฒูู ๐
- **ุงูุชุญูู ูู ูุฌูุฏ ุงูุญุฌุฒ**: ุชุฃููุฏ ุฃู `booking_id` ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ูุทุงุจูุฉ ุฑูู ุงููุงุชู**: ุงูุชุฃูุฏ ูู ุฃู ุงูุฑูู ูุทุงุจู ููุฑูู ุงููุณุฌู ูู ุจูุงูุงุช ุงููุฒูู
- **ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุฌุฒ**: ุชุฃููุฏ ุฃู ุงูุญุฌุฒ ูุดุท (ุบูุฑ ููุบู ุฃู ูุญุฐูู)
- **ุชูุณูู ุงูุฃุฑูุงู ุงูููููุฉ**: ุชุญููู ุฌููุน ุงูุฃุฑูุงู ููุตูุบุฉ ุงูุฏูููุฉ ุงูููุญุฏุฉ

### 2. ุขููุฉ ุงูุญูุงูุฉ ุงููุชุนุฏุฏุฉ ุงูุทุจูุงุช ๐ก๏ธ
```
ุงูุทุจูุฉ 1: ุชูุณูู ุฑูู ุงููุงุชู ุงููููู
    โ
ุงูุทุจูุฉ 2: ุงูุชุญูู ูู ูุฌูุฏ booking_id
    โ  
ุงูุทุจูุฉ 3: ูุทุงุจูุฉ ุงูุฑูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
    โ
ุงูุทุจูุฉ 4: ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุฌุฒ ุงููุดุทุฉ
    โ
ุงูุทุจูุฉ 5: ุญูุธ ุงูุฑุณุงูุฉ ูุฅุฑุณุงููุง
```

### 3. ูุธุงู ุงูุชุชุจุน ุงููุญุณู ๐
- **ุฅุญุตุงุฆูุงุช ููุตูุฉ**: ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุนุงูุฌุฉุ ุงููุฑุณูุฉุ ุบูุฑ ุงูุตุงูุญุฉุ ูุงููุนููุฉ
- **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**: ุชูุถูุญ ุณุจุจ ูุดู ุฅุฑุณุงู ูู ุฑุณุงูุฉ
- **ุณุฌู ุดุงูู**: ุชุชุจุน ุฌููุน ุงูุนูููุงุช ูุน ุงูุทูุงุจุน ุงูุฒูููุฉ

---

## ููููุฉ ุนูู ุงููุธุงู

### ุนูุฏ ุฅุถุงูุฉ ุญุฌุฒ ุฌุฏูุฏ
1. ูุชู ุญูุธ ุจูุงูุงุช ุงููุฒูู ูู ุฌุฏูู `bookings`
2. ูุชู ุฅูุดุงุก `booking_id` ูุฑูุฏ
3. ูุชู ุฑุจุท ุฑูู ุงููุงุชู ุจู `booking_id`

### ุนูุฏ ุฅุฑุณุงู ุฑุณุงูุฉ ูุงุชุณุงุจ
1. **ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ**: `send_yemeni_whatsapp($phone, $message, $booking_id)`
2. **ุงูุชุญูู ูู ุงูุฑูู**: ุชูุณูู ุงูุฑูู ููุตูุบุฉ ุงูููููุฉ ุงูุตุญูุญุฉ
3. **ุงูุชุญูู ูู ุงููุฒูู**: ุงุณุชุฏุนุงุก `validate_guest_phone()`
4. **ูุทุงุจูุฉ ุงูุจูุงูุงุช**: ุงูุชุฃูุฏ ูู ุชุทุงุจู ุงูุฑูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. **ุญูุธ ุงูุฑุณุงูุฉ**: ุฅูุง ุงูุฅุฑุณุงู ุงูููุฑู ุฃู ุงูุญูุธ ููุฅุฑุณุงู ูุงุญูุงู

### ูุซุงู ุนูู ุงูุชุญูู ูู ุตุญุฉ ุงููุฒูู
```php
function validate_guest_phone($phone, $booking_id) {
    // ุงูุชุญูู ูู ูุฌูุฏ booking_id
    if ($booking_id === null) return false;
    
    // ุชูุณูู ุฑูู ุงููุงุชู
    $formatted_phone = format_yemeni_phone($phone);
    
    // ุฌูุจ ุจูุงูุงุช ุงููุฒูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    $guest_data = get_booking_data($booking_id);
    
    // ูุทุงุจูุฉ ุงูุฑูู ุงููุฏุฎู ูุน ุงููุณุฌู
    if ($formatted_phone !== format_yemeni_phone($guest_data['guest_phone'])) {
        return false;
    }
    
    // ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุฌุฒ ุงููุดุทุฉ
    if (in_array($guest_data['status'], ['ููุบู', 'ูุญุฐูู'])) {
        return false;
    }
    
    return true;
}
```

---

## ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### โ ุฑุณุงุฆู ุณุชูุฑุณู ุจูุฌุงุญ:
- ุงููุฒูู ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฑูู ุงููุงุชู ูุทุงุจู ูููุณุฌู
- ุงูุญุฌุฒ ูู ุญุงูุฉ ูุดุทุฉ (ูุญุฌูุฒุฉ/ุดุงุบุฑุฉ)
- `booking_id` ุตุงูุญ

### โ ุฑุณุงุฆู ูู ุชูุฑุณู:
- ุฑูู ูุงุชู ุบูุฑ ูุทุงุจู ูููุฒูู
- `booking_id` ุบูุฑ ููุฌูุฏ
- ุงูุญุฌุฒ ููุบู ุฃู ูุญุฐูู
- ุฑูู ูุงุชู ุจุตูุบุฉ ุฎุงุทุฆุฉ

---

## ุงูุฏูุงู ุงูุฌุฏูุฏุฉ

### `validate_guest_phone($phone, $booking_id)`
```php
// ุงูุชุญูู ูู ุตุญุฉ ุฑูู ุงููุงุชู ูููุฒูู ุงููุญุฏุฏ
$is_valid = validate_guest_phone("967712345678", 123);
```

### `get_guest_info($booking_id)`
```php
// ุฌูุจ ูุนูููุงุช ุงููุฒูู ุงููุงููุฉ
$guest = get_guest_info(123);
echo $guest['guest_name']; // ุงุณู ุงููุฒูู
echo $guest['guest_phone']; // ุฑูู ุงููุงุชู
echo $guest['room_number']; // ุฑูู ุงูุบุฑูุฉ
```

### `send_whatsapp_to_guest($booking_id, $template)`
```php
// ุฅุฑุณุงู ุฑุณุงูุฉ ูุญุฏุฏุฉ ูููุฒูู
send_whatsapp_to_guest(123, 'welcome');
send_whatsapp_to_guest(123, 'payment_reminder');
send_whatsapp_to_guest(123, 'checkout_reminder');
```

---

## ููุงูุจ ุงูุฑุณุงุฆู ุงููุชุงุญุฉ

### ๐จ ุฑุณุงูุฉ ุงูุชุฑุญูุจ
```
ูุฑุญุจุงู ุจู ูู ููุฏู ูุงุฑููุง ๐จ
ุนุฒูุฒู/ุฉ [ุงุณู ุงููุฒูู]
ุชู ุชุฃููุฏ ุญุฌุฒู ูู ุงูุบุฑูุฉ [ุฑูู ุงูุบุฑูุฉ]
ูุชููู ูู ุฅูุงูุฉ ููุชุนุฉ ๐
```

### ๐ฐ ุชุฐููุฑ ุจุงูุฏูุน
```
ุชุฐููุฑ ุจุงูุฏูุน ๐ฐ
ุนุฒูุฒู/ุฉ [ุงุณู ุงููุฒูู]
ุงูุบุฑูุฉ: [ุฑูู ุงูุบุฑูุฉ]
ูุฑุฌู ุชุณุฏูุฏ ุงููุณุชุญูุงุช ุงููุชุจููุฉ
ุดูุฑุงู ูุชูููู ๐
```

### ๐ ุชุฐููุฑ ุจุงููุบุงุฏุฑุฉ
```
ุชุฐููุฑ ุจุงููุบุงุฏุฑุฉ ๐
ุนุฒูุฒู/ุฉ [ุงุณู ุงููุฒูู]
ุงูุบุฑูุฉ: [ุฑูู ุงูุบุฑูุฉ]
ููุนุฏ ุงููุบุงุฏุฑุฉ ุงูููู
ุดูุฑุงู ูุงุฎุชูุงุฑู ููุฏููุง ๐
```

---

## ูุธุงู ุงูุชูุงุฑูุฑ

### ุฅุญุตุงุฆูุงุช ุงููุนุงูุฌุฉ
```
โข ุชู ูุนุงูุฌุฉ: 50 ุฑุณุงูุฉ
โข ุชู ุฅุฑุณุงู: 45 ุฑุณุงูุฉ
โข ุฑุณุงุฆู ุบูุฑ ุตุงูุญุฉ: 3 ุฑุณุงุฆู
โข ุฑุณุงุฆู ูุนููุฉ: 2 ุฑุณุงุฆู
```

### ุฃููุงุน ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ
1. **"ุฑูู ุงููุงุชู ุบูุฑ ูุทุงุจู ูููุฒูู ุงููุณุฌู"**
   - ุงูุณุจุจ: ุงูุฑูู ุงููุฏุฎู ูุฎุชูู ุนู ุงููุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงูุญู: ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ

2. **"ูุง ููุฌุฏ ุญุฌุฒ ุจุฑูู"**
   - ุงูุณุจุจ: `booking_id` ุบูุฑ ููุฌูุฏ
   - ุงูุญู: ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงูุญุฌุฒ

3. **"ุงูุญุฌุฒ ูู ุญุงูุฉ ุบูุฑ ูุดุทุฉ"**
   - ุงูุณุจุจ: ุงูุญุฌุฒ ููุบู ุฃู ูุญุฐูู
   - ุงูุญู: ุชุญุฏูุซ ุญุงูุฉ ุงูุญุฌุฒ ุฃู ุนุฏู ุฅุฑุณุงู ุงูุฑุณุงูุฉ

---

## ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

### ุญูุงูุฉ ุงูุจูุงูุงุช ๐
- ูุง ูููู ุฅุฑุณุงู ุฑุณุงุฆู ูุฃุฑูุงู ุบูุฑ ูุณุฌูุฉ
- ุฌููุน ุงูุนูููุงุช ูุณุฌูุฉ ููุฑุงูุจุฉ
- ุงูุชุญูู ุงููุชุนุฏุฏ ุงูุทุจูุงุช ูู ุตุญุฉ ุงูุจูุงูุงุช

### ุณุฌู ุงูุนูููุงุช ๐
- ูู ุฑุณุงูุฉ ูุฑุชุจุทุฉ ุจู `booking_id` ูุญุฏุฏ
- ุชุชุจุน ูุญุงููุงุช ุงูุฅุฑุณุงู ูุฃุณุจุงุจ ุงููุดู
- ุฅุดุนุงุฑุงุช ููุฑูุฉ ูููุดุฑููู ุนูุฏ ูุฌูุฏ ูุดุงูู

---

## ุงูุตูุงูุฉ ูุงููุฑุงูุจุฉ

### ูููุงุช ุงูุณุฌู
- `logs/whatsapp_queue.log`: ุณุฌู ูุนุงูุฌุฉ ุงูุฑุณุงุฆู
- ูุงุนุฏุฉ ุงูุจูุงูุงุช: ุฌุฏูู `whatsapp_messages`
- ุฅุดุนุงุฑุงุช ุงููุธุงู: ุฌุฏูู `system_notifications`

### ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ
- ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููุนููุฉ ูู 5 ุฏูุงุฆู
- ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ุงูุชุดุงู ุฑุณุงุฆู ุบูุฑ ุตุงูุญุฉ
- ุชูุงุฑูุฑ ุฏูุฑูุฉ ุนู ุญุงูุฉ ุงููุธุงู

---

## ุฎูุงุตุฉ ุงูุชุญุฏูุซ

โ **ุชู ุชุญูููู:**
- ุงูุฑุณุงุฆู ุชุฑุณู ููุท ูููุฒูุงุก ุงููุณุฌููู
- ุงูุชุญูู ุงูุดุงูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ูุธุงู ุชุชุจุน ูุชูุงุฑูุฑ ูุญุณู
- ุญูุงูุฉ ุฃูุถู ููุจูุงูุงุช ุงูุดุฎุตูุฉ

๐ **ุงูุนูููุงุช ุงููุญุณูุฉ:**
- ุณุฑุนุฉ ูุนุงูุฌุฉ ุฃูุถู
- ุฅุดุนุงุฑุงุช ุฃูุซุฑ ูุถูุญุงู
- ุณุฌูุงุช ููุตูุฉ ูููุฑุงุฌุนุฉ
- ูุงุฌูุฉ ุฅุฏุงุฑุฉ ูุญุณูุฉ

---

*ุขุฎุฑ ุชุญุฏูุซ: ููููุจุฑ 2024*
*ูุฑูู ุชุทููุฑ ูุธุงู ููุฏู ูุงุฑููุง*