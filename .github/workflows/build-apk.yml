name: ðŸš€ Marina Hotel APK Builder

on:
  push:
    branches:
      - main
      - develop
      - 'release/**'
      - 'capy/**'  # Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ ÙØ±ÙˆØ¹ capy
      - 'feature/**'
    paths:
      - 'mobile/**'
      - '.github/workflows/**'
  pull_request:
    branches:
      - main
      - develop
    paths:
      - 'mobile/**'
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡'
        required: true
        default: 'release'
        type: choice
        options:
          - 'debug'
          - 'release'
      base_api_url:
        description: 'BASE_API_URL (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)'
        required: false
        default: 'http://hotelmarina.com/MARINA_HOTEL_PORTABLE/api/v1'
      create_release:
        description: 'Ø¥Ù†Ø´Ø§Ø¡ GitHub Release'
        type: boolean
        default: false

permissions:
  contents: write
  actions: read
  checks: write

concurrency:
  group: apk-build-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  FLUTTER_VERSION: '3.24.0'
  JAVA_VERSION: '17'

jobs:
  setup:
    name: ðŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      build_type: ${{ steps.config.outputs.build_type }}
      should_release: ${{ steps.config.outputs.should_release }}
      version_name: ${{ steps.version.outputs.version_name }}
      build_number: ${{ steps.version.outputs.build_number }}
      
    steps:
      - name: âœ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸŽ¯ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡
        id: config
        run: |
          # ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø£Ùˆ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            BUILD_TYPE="${{ github.event.inputs.build_type }}"
            SHOULD_RELEASE="${{ github.event.inputs.create_release }}"
          elif [[ "${{ github.ref }}" == refs/tags/v* ]] || [[ "${{ github.ref }}" == *release* ]] || [[ "${{ github.ref }}" == refs/heads/main ]]; then
            BUILD_TYPE="release"
            SHOULD_RELEASE="true"
          else
            BUILD_TYPE="debug"
            SHOULD_RELEASE="false"
          fi
          
          echo "build_type=$BUILD_TYPE" >> $GITHUB_OUTPUT
          echo "should_release=$SHOULD_RELEASE" >> $GITHUB_OUTPUT
          
          echo "ðŸŽ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡: $BUILD_TYPE"
          echo "ðŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Release: $SHOULD_RELEASE"

      - name: ðŸ“‹ Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±
        id: version
        working-directory: mobile
        run: |
          if [ -f "pubspec.yaml" ]; then
            VERSION_NAME=$(grep '^version:' pubspec.yaml | awk '{print $2}' | cut -d'+' -f1)
          else
            VERSION_NAME="1.0.0"
          fi
          
          BUILD_NUMBER=${{ github.run_number }}
          COMMIT_SHORT=$(git rev-parse --short HEAD)
          DATE_UTC=$(date -u +'%Y%m%d')
          
          echo "version_name=$VERSION_NAME" >> $GITHUB_OUTPUT
          echo "build_number=$BUILD_NUMBER" >> $GITHUB_OUTPUT
          echo "commit_short=$COMMIT_SHORT" >> $GITHUB_OUTPUT
          echo "date=$DATE_UTC" >> $GITHUB_OUTPUT
          
          echo "ðŸ“¦ Ø§Ù„Ø¥ØµØ¯Ø§Ø±: v$VERSION_NAME"
          echo "ðŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡: $BUILD_NUMBER"
          echo "ðŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: $DATE_UTC"
          echo "ðŸ”— Commit: $COMMIT_SHORT"

  build-apk:
    name: ðŸ“± Ø¨Ù†Ø§Ø¡ APK
    needs: setup
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    strategy:
      matrix:
        include:
          - name: "ARM64 (Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©)"
            target: "android-arm64"
            suffix: "arm64"
          - name: "Universal (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)"
            target: "android-arm,android-arm64,android-x64"
            suffix: "universal"
    
    defaults:
      run:
        working-directory: mobile
    
    steps:
      - name: âœ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: â˜• ØªØ«Ø¨ÙŠØª Java ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'gradle'

      - name: ðŸ¦ ØªØ«Ø¨ÙŠØª Flutter ${{ env.FLUTTER_VERSION }}
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: ðŸ“¦ ÙƒØ§Ø´ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
        uses: actions/cache@v4
        with:
          path: |
            ~/.pub-cache
            mobile/.dart_tool
            mobile/build
          key: ${{ runner.os }}-flutter-${{ needs.setup.outputs.build_type }}-${{ hashFiles('mobile/pubspec.lock') }}
          restore-keys: |
            ${{ runner.os }}-flutter-${{ needs.setup.outputs.build_type }}-
            ${{ runner.os }}-flutter-

      - name: ðŸ” ÙØ­Øµ Flutter
        run: |
          echo "ðŸ” ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯ Flutter..."
          flutter --version
          flutter doctor -v
          
          echo "ðŸ” ÙØ­Øµ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹..."
          [ ! -d "android" ] && echo "âŒ Ù…Ø¬Ù„Ø¯ android Ù…ÙÙ‚ÙˆØ¯" && exit 1
          [ ! -f "pubspec.yaml" ] && echo "âŒ Ù…Ù„Ù pubspec.yaml Ù…ÙÙ‚ÙˆØ¯" && exit 1
          echo "âœ… Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ØµØ­ÙŠØ­Ø©"

      - name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
        run: |
          echo "ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Flutter..."
          flutter pub get
          echo "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­"

      - name: ðŸ”¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ (Ø¥Ù† ÙˆØ¬Ø¯)
        continue-on-error: true
        run: |
          echo "ðŸ”¨ ØªØ´ØºÙŠÙ„ build_runner..."
          flutter pub run build_runner build --delete-conflicting-outputs || echo "âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª Ù„Ù„ØªÙˆÙ„ÙŠØ¯"

      - name: ðŸ” Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù„Ù„Ù€ Release
        if: needs.setup.outputs.build_type == 'release'
        env:
          KEYSTORE_BASE64: ${{ secrets.KEYSTORE_BASE64 }}
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: |
          echo "ðŸ” Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù„Ù„Ù€ Release..."
          
          if [ -n "$KEYSTORE_BASE64" ] && [ -n "$KEYSTORE_PASSWORD" ]; then
            echo "$KEYSTORE_BASE64" | base64 -d > android/app/upload-keystore.jks
            
            cat > android/key.properties << EOF
          storeFile=upload-keystore.jks
          storePassword=$KEYSTORE_PASSWORD
          keyAlias=$KEY_ALIAS
          keyPassword=$KEY_PASSWORD
          EOF
            echo "âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹"
          else
            echo "âš ï¸ Ø£Ø³Ø±Ø§Ø± Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù…ÙÙ‚ÙˆØ¯Ø© - Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙˆÙ‚ÙŠØ¹ Debug"
          fi

      - name: ðŸ“± Ø¨Ù†Ø§Ø¡ APK (${{ matrix.name }})
        env:
          BASE_API_URL: ${{ github.event.inputs.base_api_url || secrets.BASE_API_URL || 'http://hotelmarina.com/MARINA_HOTEL_PORTABLE/api/v1' }}
        run: |
          BUILD_TYPE="${{ needs.setup.outputs.build_type }}"
          echo "ðŸ“± Ø¨Ù†Ø§Ø¡ $BUILD_TYPE APK - ${{ matrix.name }}..."
          echo "ðŸŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… BASE_API_URL: $BASE_API_URL"
          
          # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡
          if [ "$BUILD_TYPE" = "release" ]; then
            BUILD_CMD="flutter build apk --release"
            BUILD_FLAG="--release"
          else
            BUILD_CMD="flutter build apk --debug"
            BUILD_FLAG="--debug"
          fi
          
          # ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ù†Ø§Ø¡
          $BUILD_CMD \
            --dart-define=BASE_API_URL="$BASE_API_URL" \
            --build-name=${{ needs.setup.outputs.version_name }} \
            --build-number=${{ needs.setup.outputs.build_number }} \
            --target-platform ${{ matrix.target }} \
            $( [ "${{ matrix.suffix }}" != "universal" ] && echo "--split-per-abi" || echo "" )
          
          echo "âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ APK Ø¨Ù†Ø¬Ø§Ø­"

      - name: ðŸ“‚ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        run: |
          echo "ðŸ“‚ ØªØ¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª APK..."
          mkdir -p ../releases/apk
          
          BUILD_TYPE="${{ needs.setup.outputs.build_type }}"
          VERSION="${{ needs.setup.outputs.version_name }}"
          BUILD_NUM="${{ needs.setup.outputs.build_number }}"
          SUFFIX="${{ matrix.suffix }}"
          
          # ØªØ­Ø¯ÙŠØ¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª
          if [ "$BUILD_TYPE" = "release" ]; then
            OUTPUT_DIR="build/app/outputs/flutter-apk"
            APK_PATTERN="*-release.apk"
          else
            OUTPUT_DIR="build/app/outputs/flutter-apk"
            APK_PATTERN="*-debug.apk"
          fi
          
          echo "ðŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ: $OUTPUT_DIR"
          echo "ðŸ” Ù†Ù…Ø· Ø§Ù„Ø¨Ø­Ø«: $APK_PATTERN"
          
          # Ù†Ø³Ø® Ù…Ù„ÙØ§Øª APK
          count=0
          for apk_file in $OUTPUT_DIR/$APK_PATTERN; do
            if [ -f "$apk_file" ]; then
              base_name=$(basename "$apk_file")
              
              # ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
              if [ "$SUFFIX" = "universal" ]; then
                new_name="marina-hotel-v${VERSION}-build${BUILD_NUM}-${BUILD_TYPE}-universal.apk"
              else
                # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
                if [[ "$base_name" == *arm64-v8a* ]]; then
                  arch="arm64"
                elif [[ "$base_name" == *armeabi-v7a* ]]; then
                  arch="armv7"  
                elif [[ "$base_name" == *x86_64* ]]; then
                  arch="x86_64"
                else
                  arch="$SUFFIX"
                fi
                new_name="marina-hotel-v${VERSION}-build${BUILD_NUM}-${BUILD_TYPE}-${arch}.apk"
              fi
              
              cp "$apk_file" "../releases/apk/$new_name"
              echo "âœ… Ù†Ø³Ø®: $new_name"
              count=$((count + 1))
            fi
          done
          
          if [ $count -eq 0 ]; then
            echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù„ÙØ§Øª APK"
            echo "ðŸ“‹ Ù…Ø­ØªÙˆÙŠØ§Øª $OUTPUT_DIR:"
            ls -la $OUTPUT_DIR/ || echo "Ø§Ù„Ù…Ø¬Ù„Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
            exit 1
          fi
          
          echo "ðŸ“‹ ØªÙ… Ù†Ø³Ø® $count Ù…Ù„Ù APK"
          echo "ðŸ“‹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù†Ø³ÙˆØ®Ø©:"
          ls -lh ../releases/apk/

      - name: â¬†ï¸ Ø±ÙØ¹ APK (${{ matrix.suffix }})
        uses: actions/upload-artifact@v4
        with:
          name: marina-hotel-apk-${{ matrix.suffix }}-${{ needs.setup.outputs.build_type }}-v${{ needs.setup.outputs.version_name }}-build${{ needs.setup.outputs.build_number }}
          path: releases/apk/*.apk
          retention-days: ${{ needs.setup.outputs.build_type == 'release' && 90 || 14 }}

  build-aab:
    name: ðŸ“¦ Ø¨Ù†Ø§Ø¡ AAB (Play Store)
    needs: setup
    if: needs.setup.outputs.build_type == 'release'
    runs-on: ubuntu-latest
    timeout-minutes: 25
    
    defaults:
      run:
        working-directory: mobile
    
    steps:
      - name: âœ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ
        uses: actions/checkout@v4

      - name: â˜• ØªØ«Ø¨ÙŠØª Java ${{ env.JAVA_VERSION }}
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'gradle'

      - name: ðŸ¦ ØªØ«Ø¨ÙŠØª Flutter ${{ env.FLUTTER_VERSION }}
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
        run: flutter pub get

      - name: ðŸ” Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
        env:
          KEYSTORE_BASE64: ${{ secrets.KEYSTORE_BASE64 }}
          KEYSTORE_PASSWORD: ${{ secrets.KEYSTORE_PASSWORD }}
          KEY_ALIAS: ${{ secrets.KEY_ALIAS }}
          KEY_PASSWORD: ${{ secrets.KEY_PASSWORD }}
        run: |
          if [ -n "$KEYSTORE_BASE64" ]; then
            echo "$KEYSTORE_BASE64" | base64 -d > android/app/upload-keystore.jks
            cat > android/key.properties << EOF
          storeFile=upload-keystore.jks
          storePassword=$KEYSTORE_PASSWORD
          keyAlias=$KEY_ALIAS
          keyPassword=$KEY_PASSWORD
          EOF
          fi

      - name: ðŸ“¦ Ø¨Ù†Ø§Ø¡ AAB
        env:
          BASE_API_URL: ${{ github.event.inputs.base_api_url || secrets.BASE_API_URL || 'http://hotelmarina.com/MARINA_HOTEL_PORTABLE/api/v1' }}
        run: |
          echo "ðŸ“¦ Ø¨Ù†Ø§Ø¡ Android App Bundle..."
          flutter build appbundle --release \
            --dart-define=BASE_API_URL="$BASE_API_URL" \
            --build-name=${{ needs.setup.outputs.version_name }} \
            --build-number=${{ needs.setup.outputs.build_number }}

      - name: ðŸ“‚ ØªØ¬Ù…ÙŠØ¹ AAB
        run: |
          mkdir -p ../releases/aab
          cp build/app/outputs/bundle/release/app-release.aab \
             "../releases/aab/marina-hotel-v${{ needs.setup.outputs.version_name }}-build${{ needs.setup.outputs.build_number }}.aab"

      - name: â¬†ï¸ Ø±ÙØ¹ AAB
        uses: actions/upload-artifact@v4
        with:
          name: marina-hotel-aab-v${{ needs.setup.outputs.version_name }}-build${{ needs.setup.outputs.build_number }}
          path: releases/aab/*.aab
          retention-days: 90

  create-release:
    name: ðŸŽ‰ Ø¥Ù†Ø´Ø§Ø¡ GitHub Release
    needs: [setup, build-apk, build-aab]
    if: always() && needs.setup.outputs.should_release == 'true' && needs.setup.outputs.build_type == 'release'
    runs-on: ubuntu-latest
    
    steps:
      - name: âœ… Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: ðŸ“‚ ØªØ¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Release
        run: |
          echo "ðŸ“‚ ØªØ¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Release..."
          mkdir -p release-files
          
          # Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª APK
          find artifacts -name "*.apk" -exec cp {} release-files/ \;
          
          # Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª AAB
          find artifacts -name "*.aab" -exec cp {} release-files/ \;
          
          echo "ðŸ“‹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©:"
          ls -lh release-files/

      - name: ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Release
        run: |
          cd release-files
          echo "ðŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Release..."
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù checksums
          echo "# Marina Hotel v${{ needs.setup.outputs.version_name }} - Build ${{ needs.setup.outputs.build_number }}" > CHECKSUMS.md
          echo "" >> CHECKSUMS.md
          echo "## SHA256 Checksums" >> CHECKSUMS.md
          echo "" >> CHECKSUMS.md
          
          for file in *.apk *.aab; do
            if [ -f "$file" ]; then
              sha256sum "$file" >> CHECKSUMS.md
              size=$(du -h "$file" | cut -f1)
              echo "- **$file** ($size)" >> CHECKSUMS.md
              echo "" >> CHECKSUMS.md
            fi
          done

      - name: ðŸŽ‰ Ø¥Ù†Ø´Ø§Ø¡ Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ needs.setup.outputs.version_name }}-build${{ needs.setup.outputs.build_number }}
          name: Marina Hotel v${{ needs.setup.outputs.version_name }}
          body: |
            # ðŸ¨ Marina Hotel Mobile v${{ needs.setup.outputs.version_name }}
            
            ## ðŸ“± ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© ÙÙ†Ø¯Ù‚ÙŠØ© Ø´Ø§Ù…Ù„
            
            ### ðŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ØµØ¯Ø§Ø±
            - **Ø±Ù‚Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** v${{ needs.setup.outputs.version_name }}
            - **Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡:** ${{ needs.setup.outputs.build_number }}
            - **Ø§Ù„ØªØ§Ø±ÙŠØ®:** $(date -u +"%Y-%m-%d")
            - **Ø§Ù„ÙØ±Ø¹:** ${{ github.ref_name }}
            - **Commit:** ${{ github.sha }}
            
            ### âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            - ðŸ¨ **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª**: Ù†Ø¸Ø§Ù… Ø­Ø¬ÙˆØ²Ø§Øª Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ø¶ÙŠÙˆÙ
            - ðŸ’° **Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹**: 5 Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ø¹ Ø¥ÙŠØµØ§Ù„Ø§Øª PDF
            - ðŸ“Š **Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±**: ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª
            - ðŸ‘¥ **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†**: ØªØªØ¨Ø¹ Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ø³Ø­ÙˆØ¨Ø§Øª
            - ðŸ  **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù**: Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØºØ±Ù ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©
            - ðŸ“ **Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª**: Ù†Ø¸Ø§Ù… Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØªØ°ÙƒÙŠØ±Ø§Øª
            - ðŸŒ **Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª**: Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Offline-First
            - ðŸ”„ **Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©**: Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            
            ### ðŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            - **Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** admin
            - **ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:** 1234
            
            ### ðŸ“± Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ«Ø¨ÙŠØª
            - **ARM64 APK**: Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Ù…ÙˆØµÙ‰ Ø¨Ù‡)
            - **Universal APK**: Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
            - **AAB**: Ù„Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ Google Play Store
            
            ### ðŸ“¥ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª
            1. Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù APK Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¬Ù‡Ø§Ø²Ùƒ
            2. ÙØ¹Ù‘Ù„ "Ø§Ù„Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©" ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯
            3. Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            4. Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… admin/1234
            
            ### ðŸ› ï¸ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
            - **Flutter:** ${{ env.FLUTTER_VERSION }}
            - **Dart:** Latest SDK
            - **Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:** SQLite Ù…Ø¹ Drift
            - **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©:** Riverpod
            - **Ø§Ù„Ø´Ø¨ÙƒØ©:** Dio HTTP Client
            - **PDF:** ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ¥ÙŠØµØ§Ù„Ø§Øª PDF
            
            ### ðŸ”§ Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
            - **API Backend:** PHP + MySQL
            - **JWT Authentication:** Ù†Ø¸Ø§Ù… ØªÙˆØ«ÙŠÙ‚ Ø¢Ù…Ù†
            - **CORS Support:** Ø¯Ø¹Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…Ù†ØµØ§Øª
            - **Offline Support:** Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¥Ù†ØªØ±Ù†Øª
            
            ---
            
            **ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GitHub Actions ðŸ¤–**
          draft: false
          prerelease: false
          files: |
            release-files/*

  summary:
    name: ðŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¨Ù†Ø§Ø¡
    needs: [setup, build-apk]
    if: always()
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø®Øµ
        run: |
          echo "## ðŸš€ Ù…Ù„Ø®Øµ Ø¨Ù†Ø§Ø¡ Marina Hotel APK" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ðŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡" >> $GITHUB_STEP_SUMMARY
          echo "- **Ù†ÙˆØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡:** ${{ needs.setup.outputs.build_type }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** v${{ needs.setup.outputs.version_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø±Ù‚Ù… Ø§Ù„Ø¨Ù†Ø§Ø¡:** ${{ needs.setup.outputs.build_number }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø§Ù„ÙØ±Ø¹:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø§Ù„ØªØ§Ø±ÙŠØ®:** $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ðŸ“¦ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©" >> $GITHUB_STEP_SUMMARY
          echo "ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª APK Ù…Ù† Artifacts Ø£Ø¹Ù„Ø§Ù‡:" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“± **ARM64 APK** - Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© (Ù…ÙˆØµÙ‰ Ø¨Ù‡)" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“± **Universal APK** - Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ needs.setup.outputs.build_type }}" = "release" ]; then
            echo "- ðŸ“¦ **AAB** - Ù„Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ Google Play Store" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" >> $GITHUB_STEP_SUMMARY
          echo "- **Username:** admin" >> $GITHUB_STEP_SUMMARY  
          echo "- **Password:** 1234" >> $GITHUB_STEP_SUMMARY
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±" >> $GITHUB_STEP_SUMMARY
          echo "ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ù‚Ø³Ù… **Artifacts** Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©" >> $GITHUB_STEP_SUMMARY