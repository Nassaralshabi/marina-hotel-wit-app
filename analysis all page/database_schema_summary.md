# ملخص بنية قاعدة البيانات (`hotel_db.sql`)

## الجداول الأساسية
- **`bookings`**: يحتفظ بتفاصيل الحجز (الضيف، الهوية، هاتف، جنسية، بريد، عنوان، رقم الغرفة، تواريخ الدخول/الخروج، الحالة، الملاحظات، عدد الليالي المحسوبة، معرف الضيف). يحتوي على Trigger لتحديث حالة الغرفة وحساب الليالي تلقائياً، بالإضافة إلى حدث مجدول لتحديث `calculated_nights` يومياً.
- **`booking_notes`**: ملاحظات مرتبطة بكل حجز مع أنواع تنبيه (`high`, `medium`, `low`) وحقل `alert_until` لتحديد صلاحية التنبيه.
- **`rooms`**: تعريف الغرف (رقم، نوع، سعر، حالة). مستخدم كمرجع أجنبي في `bookings`.
- **`payment`**: معاملات مدفوعة مرتبطة بالحجوزات مع معلومات طريقة الدفع ونوع الإيراد (`room`, `restaurant`, `services`, `other`).
- **`invoices`**: فواتير صادرة مرتبطة بالحجوزات (محرك MyISAM).
- **`cash_register`** و **`cash_transactions`**: إدارة الصندوق اليومي، الأرصدة الافتتاحية والختامية، وحركات النقد.
- **`expenses`**, **`expense_logs`**, **`salary_withdrawals`**: مصروفات الفندق، سجل التعديلات، وسحوبات الرواتب.
- **`employees`**: الموظفون مع الراتب الأساسي والحالة.
- **`suppliers`**: الموردون المرتبطون بالمصروفات.
- **`users`**, **`permissions`**, **`user_permissions`**, **`user_activity_log`**, **`failed_logins`**: إدارة الحسابات والصلاحيات وسجلات الدخول ومحاولات الفشل.

## خصائص إضافية
- معظم الجداول تستخدم محرك InnoDB مع مفاتيح أساسية وفهارس لتحسين الأداء (على سبيل المثال فهارس على `status`, `checkin_date`, `guest_phone`).
- هناك حدث (`EVENT update_nights_calculation`) لتحديث الليالي المحسوبة يومياً للحجوزات قيد الإقامة.
- توجد قيود مرجعية (`FOREIGN KEY`) بين الحجوزات والغرف، الملاحظات والحجوزات، المعاملات النقدية وسجل الصندوق، والسجلات المرتبطة بالمصروفات.

## مطابقة مع نسخة الموبايل
- جداول drift في `local_db.dart` تعكس نفس الهياكل الأساسية: `Rooms`, `Bookings`, `BookingNotes`, `Employees`, `Expenses`, `CashTransactions`, `Payments`، مع حقول إضافية للمزامنة (`localUuid`, `serverId`, `lastModified`, إلخ).
- لا تظهر جداول مثل `shift_notes` أو `user_activity_log` في نسخة الموبايل، بينما تغطي نسخة الموبايل الجداول التشغيلية الأساسية اللازمة للإدارة اليومية.
