# تحليل شاشات ولوحات إدارة الويب (PHP - مجلد `admin`)

## الحجوزات (`admin/bookings`)
- **`add.php` / `add2.php`**: نماذج إدخال حجز جديد مع تعقيم المدخلات، التحقق من حالة الغرفة، واستخدام معاملات `bookings` و`rooms`. الحقول الأساسية: بيانات الضيف، أرقام الهوية، التواريخ، الملاحظات، رقم الغرفة.
- **`add_note.php`**: إدارة ملاحظات الحجز عبر جدول `booking_notes` (إضافة/حذف، قراءة التنبيهات).
- **`checkout.php`**: حساب الليالي والمبالغ المتبقية وتحديث حالة الغرفة إلى شاغرة عند المغادرة.
- **`edit.php`**: تعديل تفاصيل الحجز مع تحديث حالة الغرفة إذا تغيّر الرقم.
- **`list.php`**: عرض الحجوزات الجارية مع حساب الليالي والمبالغ (استعلامات فرعية للمدفوعات والتنبيهات).
- **ملفات `payment*.php`**: عدة نسخ لواجهة المدفوعات تتصل بجدول `payment`, وتستدعي `send_yemeni_whatsapp`, تدير الإيصالات، وتسمح بتسجيل المدفوعات أو إنهاء الحجز.
- **`receipt.php`**: توليد إيصال PDF للدفعة عبر FPDF.
- **`view.php`**: عرض مبسط للحجوزات مع ربط جدول `guests`.

## الغرف (`admin/rooms`)
- **`add.php` / `edit.php`**: إضافة/تعديل غرف (`rooms` table) مع التحقق من التكرار.
- **`list.php`**: عرض جميع الغرف وروابط العمليات.
- **`view.php`**: تفاصيل غرفة محددة.

## المصروفات (`admin/expenses`)
- **`add_expense.php`**: إدخال مصروف أو سحب راتب مع تحديث `expenses`، `salary_withdrawals`, `expense_logs`.
- **`edit_expense.php`**: تعديل مصروف وتسجيل العملية.
- **`delete_expense.php`**: حذف مصروف مع تسجيل في `expense_logs`.
- **`expenses.php` / `list.php`**: عرض المصروفات والسحوبات (مع فلترة حسب التاريخ والنوع وإحصاءات إجمالية).
- **`salary_withdrawals.php`**: إدارة سحوبات الرواتب.
- **`check_database.php`**: فحص وإنشاء الجداول المرتبطة بالمصروفات تلقائياً.

## الإعدادات (`admin/settings`)
- **`index.php`**: لوحة الإعدادات العامة مع إحصاءات (الغرف، الحجوزات، المستخدمين، الموظفين).
- **`add_employee.php` / `employees.php`**: إنشاء جدول `employees` إذا لم يوجد، إضافة/تعديل/حذف، إدارة الحالة.
- **`add_user.php` / `users.php`**: إدارة المستخدمين والصلاحيات (`users`, `permissions`, `user_permissions`).
- **`guests.php` / `guest_history.php` / `edit_guest.php`**: عرض معلومات الضيوف وتاريخ حجوزاتهم وتحديث البيانات.
- **`rooms_status.php`**: عرض حالات الغرف مع إمكانية تغيير الحالة وإظهار الإحصاءات.
- **`maintenance.php`**: مهام صيانة تشمل تنظيف الجلسات، تحسين الجداول، إعادة تعيين كلمات المرور، نسخ احتياطي سريع.
- **`get_user_permissions.php`**: واجهة JSON لجلب صلاحيات مستخدم معين.

## الملاحظات (`admin/notes`)
- **`index.php`**: واجهة CRUD لملاحظات المناوبة (`shift_notes`) مع فلاتر وفواصل زمنية.
- **`get_notifications.php`**: يحسب عدد الإشعارات غير المقروءة ويجلب آخر 5 ملاحظات للنوبة الحالية.
- **`get_note.php`**: يعيد تفاصيل ملاحظة واحدة بصيغة JSON.

## المالية (`admin/finance`)
- **`cash_register.php`**: فتح سجل صندوق يومي، إضافة معاملات نقدية، إغلاق الصندوق، عرض الحركات (`cash_register`, `cash_transactions`).
- **`cash_reports.php`**: تقارير يومية/شهرية/سنوية، تحليل الإيرادات والمصروفات وعرض رسوم بيانية، مع عرض كامل للحركات في الفترة المحددة.

## ملاحظات إضافية
- جميع الملفات تعتمد على `includes/db.php` و`includes/auth.php` للتحقق من الجلسة والاتصال بقاعدة البيانات.
- معظم العمليات تستخدم Prepared Statements (`bind_param`) باستثناء بعض النسخ الاحتياطية (`*.php1`).
- الاستعلامات تغطي الجداول نفسها المستخدمة في نسخة الموبايل (الحجوزات، الغرف، المدفوعات، المصروفات، الموظفين، الصندوق، إلخ).
